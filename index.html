<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Verifikasi Surat Resmi RT 007/06</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      padding: 20px;
    }
    .card {
      background: #ffffff;
      max-width: 520px;
      margin: auto;
      padding: 22px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    h3 {
      text-align: center;
      margin-bottom: 20px;
    }
    .valid {
      color: #1a7f37;
      font-weight: bold;
      text-align: center;
      margin-bottom: 16px;
    }
    .invalid {
      color: #b3261e;
      font-weight: bold;
      text-align: center;
      margin-bottom: 16px;
    }
    p {
      margin: 6px 0;
    }
    hr {
      margin: 16px 0;
    }
    .footer {
      font-size: 12px;
      color: #666;
      text-align: center;
      margin-top: 20px;
    }
  </style>
</head>
<body>

<div class="card">
  <h3>VERIFIKASI SURAT RESMI<br>RT 007/06</h3>
  <div id="hasil">Memeriksa keabsahan surat...</div>
</div>

<script>
  const apiUrl = "https://script.google.com/macros/s/AKfycbzSuGPN1lYgENxtDdTwH15OfNSMMM58Rqc24BPt_F7oIetgssRhGIUn4qGdXFhZjOToVw/exec";
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  function formatTanggal(tgl) {
    const bulan = [
      "Januari","Februari","Maret","April","Mei","Juni",
      "Juli","Agustus","September","Oktober","November","Desember"
    ];
    const d = new Date(tgl);
    return d.getDate() + " " + bulan[d.getMonth()] + " " + d.getFullYear();
  }

  if (!id) {
    document.getElementById("hasil").innerHTML = `
      <p class="invalid">ID surat tidak ditemukan.</p>
      <div class="footer">
        Silakan periksa kembali QR Code atau tautan yang digunakan.
      </div>
    `;
  } else {
    fetch(apiUrl + "?id=" + encodeURIComponent(id))
      .then(res => res.json())
      .then(data => {
        if (data.status === "valid") {
          document.getElementById("hasil").innerHTML = `
            <p class="valid">SURAT ASLI & SAH</p>

            <p><b>Nomor Surat:</b><br>${data.nomor_surat}</p>
            <p><b>Warga:</b><br>${data.warga}</p>
            <p><b>Jenis Surat:</b><br>${data.jenis_surat}</p>
            <p><b>Tanggal Pengesahan:</b><br>${formatTanggal(data.tanggal_sah)}</p>

            <hr>

            <p><b>Dibuat oleh:</b><br>${data.pelaksana_arisan}, Pelaksana Arisan RT 007/06</p>
            
            <p><b>Diketahui oleh:</b><br>Darmanto, Pengelola Dana Sehat RT 007/06</p>

            <p><b>Disahkan oleh:</b><br>Abdul Kadir, Ketua RT 007/06</p>

            <div class="footer">
              Surat ini telah diverifikasi melalui sistem digital RT 007/06.
              
              <p><i>This system was created by anang</i>
            </div>
          `;
        } else {
          document.getElementById("hasil").innerHTML = `
            <p class="invalid">SURAT TIDAK TERDAFTAR ATAU TIDAK SAH</p>
            <div class="footer">
              Jika terdapat perbedaan data, silakan konfirmasi ke pengurus RT.
            </div>
          `;
        }
      })
      .catch(() => {
        document.getElementById("hasil").innerHTML = `
          <p class="invalid">VERIFIKASI TIDAK DAPAT DILAKUKAN</p>
          <div class="footer">
            Sistem sedang tidak dapat diakses. Silakan coba kembali.
          </div>
        `;
      });
  }
</script>

</body>
</html>
