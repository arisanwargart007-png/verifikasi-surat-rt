<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Verifikasi Surat RT 007/06</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; padding:20px; }
    .card { background:#fff; max-width:500px; margin:auto; padding:20px; border-radius:6px; }
    .valid { color:green; font-weight:bold; }
    .invalid { color:red; font-weight:bold; }
    .debug { color:#555; font-size:12px; margin-top:10px; }
  </style>
</head>
<body>

<div class="card">
  <h3>VERIFIKASI SURAT RESMI RT 007/06</h3>
  <div id="hasil">Memeriksa...</div>
  <div id="debug" class="debug"></div>
</div>

<script>
  // ===== FUNGSI GLOBAL (HARUS DI LUAR IF) =====
  function formatTanggal(tgl) {
    const bulan = [
      "Januari","Februari","Maret","April","Mei","Juni",
      "Juli","Agustus","September","Oktober","November","Desember"
    ];
    const d = new Date(tgl);
    if (isNaN(d)) return "-";
    return d.getDate() + " " + bulan[d.getMonth()] + " " + d.getFullYear();
  }

  // ===== KONFIGURASI =====
  const apiUrl = "https://script.google.com/macros/s/AKfycbwORvm58LmIy4ng9iWcuWGPgCwwHdrDazVAn-SzYsJWODp6PiHS4g9cZWGhqgrogMcS0A/exec";
  const params = new URLSearchParams(window.location.search);
  const id = params.get("id");

  document.getElementById("debug").innerText =
    "DEBUG:\nID = " + id + "\nAPI = " + apiUrl;

  // ===== LOGIKA UTAMA =====
  if (!id) {
    document.getElementById("hasil").innerHTML =
      "<p class='invalid'>ID surat tidak ditemukan di URL.</p>";
  } else {
    fetch(apiUrl + "?id=" + encodeURIComponent(id))
      .then(res => res.json())
      .then(data => {
        if (data.status === "valid") {
          document.getElementById("hasil").innerHTML = `
            <p class="valid">STATUS: SURAT ASLI & SAH</p>
            <p><b>Nomor Surat:</b> ${data.nomor_surat}</p>
            <p><b>Nama Warga:</b> ${warga}</p>
            <p><b>Jenis Surat:</b> ${data.jenis_surat}</p>
            <p><b>Tanggal Sah:</b> ${formatTanggal(data.tanggal_sah)}</p>
            <hr>
            <p><b>Dibuat oleh:</b><br>${data.pelaksana_arisan}<br>Pelaksana Arisan RT 007/06</p>
            <p><b>Dibuat oleh:</b><br>Pengelola Dana Sehat RT 007/06</p>
            <p><b>Dibuat oleh:</b><br>Ketua RT 007/06</p>
          `;
        } else {
          document.getElementById("hasil").innerHTML =
            "<p class='invalid'>SURAT TIDAK TERDAFTAR / TIDAK SAH</p>";
        }
      })
      .catch(err => {
        document.getElementById("hasil").innerHTML =
          "<p class='invalid'>GAGAL MENGHUBUNGI SERVER</p>";
        document.getElementById("debug").innerText += "\nERROR: " + err;
      });
  }
</script>

</body>
</html>
